
---

# üìÑ **ARCHITECTURE.md**

*ETL-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≤–∏—Ç—Ä–∏–Ω –∏ —Ñ–∏—á–µ–π –æ–Ω–ª–∞–π–Ω-–∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞*

---

# 1. –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Ü–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–û–Ω–ª–∞–π–Ω-–∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö:

* `content` (—Ñ–∏–ª—å–º—ã, –∂–∞–Ω—Ä—ã, –ø–µ—Ä—Å–æ–Ω—ã),
* `ugc` (–æ—Ü–µ–Ω–∫–∏, –æ—Ç–∑—ã–≤—ã, –ø—Ä–æ—Å–º–æ—Ç—Ä—ã),
* `auth`.

–î–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –æ—Ç—á—ë—Ç–æ–≤ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ **–¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤–∏—Ç—Ä–∏–Ω** –≤ —Å—Ö–µ–º–µ `analytics` ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä:

* –≤–∏—Ç—Ä–∏–Ω–∞ –ø–æ —Ñ–∏–ª—å–º–∞–º (`film_dim`);
* –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏ (`film_rating_agg`);
* —Ñ–∏—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–ª–∏ —Ñ–∏–ª—å–º–æ–≤;
* —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∞—É–¥–∏—Ç–æ—Ä–∏–∏.

–¶–µ–ª—å –¥–∏–ø–ª–æ–º–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å **—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é ETL-–ø–ª–∞—Ç—Ñ–æ—Ä–º—É**, –∫–æ—Ç–æ—Ä–∞—è:

* —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π, –∞ –Ω–µ –∂—ë—Å—Ç–∫–æ –∑–∞—à–∏—Ç–∞ –≤ –∫–æ–¥;
* –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ –ø—Ä–∏—ë–º–Ω–∏–∫–∏ (–≤ MVP ‚Äî Postgres ‚Üí Postgres);
* —É–º–µ–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è/—Å—Ç–∞–≤–∏—Ç—å—Å—è –Ω–∞ –ø–∞—É–∑—É/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ REST API;
* –Ω–∞–¥—ë–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –±–∞—Ç—á–∞–º–∏ –∏ —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ;
* –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–±–æ–µ–≤;
* –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å **SQL-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏** (MVP) –∏ **Python-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏** (–∫–∞–∫ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å);
* –ø—Ä–∏–≥–æ–¥–Ω–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏ (Airflow).

---

# 2. –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

## 2.1. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
[–û–Ω–ª–∞–π–Ω-–∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä]
  - content DB (schema content)
  - ugc DB (schema ugc)
        |
        v
+--------------------------------------+
|           ETL-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞             |
|--------------------------------------|
|  [ETL API]  ‚Üê‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å          |
|  [ETL Runner] ‚Äî –¥–≤–∏–∂–æ–∫ –ø–∞–π–ø–ª–∞–π–Ω–æ–≤    |
|  [ETL Meta DB] ‚Äî —Å—Ö–µ–º—ã etl/state     |
+--------------------------------------+
        |
        v
[–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ]
  - Postgres schema analytics
```

---

## 2.2. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ Docker Compose

```
+-------------------------------------------------------------+
|                       Docker Compose                        |
+-------------------------------------------------------------+
|                                                             |
|  +-------------------+       +---------------------------+  |
|  |   ETL API         |<----->|        Postgres           |  |
|  | (FastAPI)         |       |---------------------------|  |
|  | - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ      |       | schemas:                 |  |
|  | - CRUD pipelines  |       |  - content (source)      |  |
|  +-------------------+       |  - ugc (source)          |  |
|           ^                  |  - analytics (target)    |  |
|           |                  |  - etl (meta/state)      |  |
|  +-------------------+       +---------------------------+  |
|  |   ETL Runner      |                                    |
|  | (Python worker)   |                                    |
|  | - –∏—Å–ø–æ–ª–Ω—è–µ—Ç ETL   |                                    |
|  | - –ø–∏—à–µ—Ç state     |                                    |
|  +-------------------+                                    |
|                                                             |
+-------------------------------------------------------------+
```

### üí° –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏ (Airflow)

–•–æ—Ç—è –≤ MVP –∑–∞–ø—É—Å–∫–æ–º ETL –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π Runner, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –≤—ã–Ω–µ—Å—Ç–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é –≤–æ –≤–Ω–µ—à–Ω–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, Airflow).
Airflow-DAG –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å:

* `POST /pipelines/{id}/run`
* `GET /pipelines/{id}/status`

–¢–µ–º —Å–∞–º—ã–º –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ **control-plane**, –∞ —Å–∞–º Runner —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –∑–≤–µ–Ω–æ–º.

---

# 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ETL Runner (–¥–≤–∏–∂–∫–∞)

```
                +----------------------------+
                |        ETL Runner         |
                +----------------------------+
                | PipelineManager           |
                | - —á–∏—Ç–∞–µ—Ç etl_pipelines   |
                | - —Å–æ–∑–¥–∞—ë—Ç Pipeline        |
                +-------------+-------------+
                              |
                 +------------v-----------+
                 |       Pipeline         |
                 | (—ç–∫–∑–µ–º–ø–ª—è—Ä –æ–¥–Ω–æ–≥–æ ETL) |
                 +------+----------+------+
                        |          |
                    +---v----+  +--v----------+
                    |Source  |  | Target      |
                    |Reader  |  | Writer      |
                    +--------+  +-------------+
                         \         /
                          \       /
                         +---v----+
                         |Transformer
                         +----------+
                              |
                        +-----v----------+
                        |  StateManager  |
                        +----------------+
```

## –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏

### **PipelineManager**

* –∏—â–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–∞–π–ø–ª–∞–π–Ω—ã;
* —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Å—Ç–∞—Ç—É—Å—ã (RUN_REQUESTED / PAUSE_REQUESTED);
* —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç `Pipeline`;
* –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª.

### **Pipeline**

* –∏—Å–ø–æ–ª–Ω—è–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω;
* –ø–æ–æ—á–µ—Ä—ë–¥–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –µ–≥–æ —à–∞–≥–∏ (`tasks`);
* –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–∞—Ç—á–∏: read ‚Üí transform ‚Üí write ‚Üí update state.

### **SourceReader**

* –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ (`source_query` –∏–ª–∏ —Ç–∞–±–ª–∏—Ü—É);
* —É—á–∏—Ç—ã–≤–∞–µ—Ç `last_processed_id` –¥–ª—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞.

### **Transformer**

* –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å—Ç—Ä–æ–∫–∏, –º–∞–ø–ø–∏—Ç —Ç–∏–ø—ã;
* –º–æ–∂–µ—Ç –±—ã—Ç—å SQL-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏–ª–∏ Python-—Ñ—É–Ω–∫—Ü–∏–µ–π.

### **TargetWriter**

* –ø–∏—à–µ—Ç –≤ —Ü–µ–ª–µ–≤—É—é —Ç–∞–±–ª–∏—Ü—É `analytics`;
* –≤—ã–ø–æ–ª–Ω—è–µ—Ç UPSERT (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å).

### **StateManager**

* —Ö—Ä–∞–Ω–∏—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç checkpoint;
* –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø—É—Å–∫–æ–≤ (`etl_runs`);
* –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤.

---

## üí° –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SQL- –∏ Python-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ç–∏–ø–∞ –∑–∞–¥–∞—á:

* **task_type = SQL**
  –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL-—Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ Postgres connection.

* **task_type = PYTHON**
  –í—ã–∑–æ–≤ Python-—Ñ—É–Ω–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ –º–æ–¥—É–ª—è `pipelines/python/`).
  –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±–æ–≥–∞—â–µ–Ω–∏—è, –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤, –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏.

–í MVP —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω SQL-–¥–≤–∏–∂–æ–∫.
–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Python-—Ç–∞—Å–∫–æ–≤ ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∞—è —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

---

# 4. ETL API (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞–º–∏)

```
Client ‚Üí FastAPI ‚Üí Postgres(etl schema) ‚Üí Runner
```

## –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

* `GET /pipelines`
* `POST /pipelines`
* `GET /pipelines/{id}`
* `POST /pipelines/{id}/run`
* `POST /pipelines/{id}/pause`
* `POST /pipelines/{id}/validate`
* `POST /pipelines/{id}/reload-config`
* `GET /pipelines/{id}/status`
* `GET /pipelines/{id}/reconcile`

API **–Ω–µ –∏—Å–ø–æ–ª–Ω—è–µ—Ç –ø–∞–π–ø–ª–∞–π–Ω—ã** ‚Äî –æ–Ω–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏.
Runner –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —á–∏—Ç–∞–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç/–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–∞–π–ø–ª–∞–π–Ω—ã.

---

# 5. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø–∞–π–ø–ª–∞–π–Ω–∞

## 5.1. –ó–∞–ø—É—Å–∫

```
1. POST /pipelines/{id}/run
2. API: status ‚Üí RUN_REQUESTED
3. Runner: –≤–∏–¥–∏—Ç RUN_REQUESTED ‚Üí —Å—Ç–∞–≤–∏—Ç RUNNING
4. Runner —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ etl_runs
5. –ß–∏—Ç–∞–µ—Ç batch ‚Üí transform ‚Üí upsert ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç state
6. –ö–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è ‚Üí —Å—Ç–∞—Ç—É—Å IDLE
```

## 5.2. –ü–∞—É–∑–∞

```
1. POST /pipelines/{id}/pause
2. API: status ‚Üí PAUSE_REQUESTED
3. Runner –∑–∞–≤–µ—Ä—à–∞–µ—Ç –±–∞—Ç—á
4. –§–∏–∫—Å–∏—Ä—É–µ—Ç state
5. –°—Ç–∞–≤–∏—Ç —Å—Ç–∞—Ç—É—Å ‚Üí PAUSED
```

---

# 6. –ú–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–∞–π–ø–ª–∞–π–Ω–∞

```
      +---------+
      |  IDLE   |
      +----+----+
           |
           | run
           v
      +----+----+
      | RUNNING |
      +----+----+
      |    |   |
pause |    |   | error
      v    |   v
  +---+--+ | +--------+
  |PAUSED| | | FAILED |
  +---+--+ | +--------+
      |    |      |
      |run |      | retry
      v    v      v
      +----+------+
```

---

# 7. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ ETL (schema: etl)

### **etl_pipelines**

| –ø–æ–ª–µ              | –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ                       |
| ----------------- | -------------------------------- |
| id                | –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä                    |
| name              | –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞               |
| source_type       | —Ç–∏–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∞                    |
| source_query      | SQL –∏—Å—Ç–æ—á–Ω–∏–∫–∞                    |
| target_table      | —Ç–∞–±–ª–∏—Ü–∞-–ø—Ä–∏—ë–º–Ω–∏–∫                 |
| mode              | full / incremental               |
| batch_size        | —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞                     |
| enabled           | –≤–∫–ª—é—á—ë–Ω –ª–∏ –ø–∞–π–ø–ª–∞–π–Ω              |
| schedule_interval | –∏–Ω—Ç–µ—Ä–≤–∞–ª –∑–∞–ø—É—Å–∫–∞                 |
| status            | IDLE / RUNNING / PAUSED / FAILED |

---

### **etl_pipeline_tasks** *(–º–Ω–æ–≥–æ—à–∞–≥–æ–≤–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ SQL/Python)*

| –ø–æ–ª–µ         | –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ                          |
| ------------ | ----------------------------------- |
| id           | –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —à–∞–≥–∞                  |
| pipeline_id  | –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á                        |
| order        | –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è                  |
| task_type    | `SQL` –∏–ª–∏ `PYTHON`                  |
| body         | SQL-—Ç–µ–∫—Å—Ç –∏–ª–∏ –ø—É—Ç—å –∫ Python-—Ñ—É–Ω–∫—Ü–∏–∏ |
| source_table | —Ç–∞–±–ª–∏—Ü–∞-–∏—Å—Ç–æ—á–Ω–∏–∫ (–¥–ª—è SQL)          |
| target_table | —Ç–∞–±–ª–∏—Ü–∞-–ø—Ä–∏—ë–º–Ω–∏–∫                    |

> –í MVP –ø–∞–π–ø–ª–∞–π–Ω –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–¥–∏–Ω task ‚Äî —ç—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π.
> –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ –ø–∞–π–ø–ª–∞–π–Ω—ã.

---

### **etl_state**

| –ø–æ–ª–µ              | –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ       |
| ----------------- | ---------------- |
| pipeline_id       | –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á     |
| last_processed_id | checkpoint       |
| updated_at        | –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

---

### **etl_runs**

| –ø–æ–ª–µ         | –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ            |
| ------------ | --------------------- |
| id           | –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø—É—Å–∫–∞ |
| pipeline_id  | –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á          |
| started_at   | –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞          |
| finished_at  | –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è       |
| rows_read    | —Å—Ç—Ä–æ–∫–∏, –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ   |
| rows_written | —Å—Ç—Ä–æ–∫–∏, –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ    |
| status       | SUCCESS / FAILED      |

---

# 8. –ü–∞–π–ø–ª–∞–π–Ω—ã –¥–ª—è MVP

1. **content.film_work ‚Üí analytics.film_dim**
   –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å–º–æ–≤: –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ä–µ–π—Ç–∏–Ω–≥, –∂–∞–Ω—Ä—ã, —Å–≤–æ–¥–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã.

2. **ugc.ratings ‚Üí analytics.film_rating_agg**
   –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ—Ü–µ–Ω–æ–∫: `avg_rating`, `rating_count`.

–≠—Ç–∏ –≤–∏—Ç—Ä–∏–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –∏ –º–æ–≥—É—Ç —Å–ª—É–∂–∏—Ç—å —Ñ–∏—á–∞–º–∏ –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π.

---

# 9. –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

* –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å ‚Äî UPSERT –≤–º–µ—Å—Ç–æ INSERT.
* –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤ ‚Äî checkpoint –≤ `etl_state`.
* –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞—Ç—á–∞–º–∏.
* –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞.
* Pause / resume.
* Reconcile —Å–æ—Å—Ç–æ—è–Ω–∏—è source ‚Üî target.
* –õ–æ–≥–∏ + –±–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏.
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Airflow.
* –ö–æ–¥ —Ä–∞–∑–¥–µ–ª—ë–Ω –ø–æ —Å–ª–æ—è–º (core / API / runner / state).

---
